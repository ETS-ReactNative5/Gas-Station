---
- hosts: pfsense
  tasks:
    - name: Update pfSense configuration
      include_tasks: tasks/pfsense/base.yml
- hosts: windows
  tasks:
    - name: Set hosts file
      include_tasks: tasks/windows/hosts.yml
    - name: Register the product key
      include_tasks: tasks/windows/activation.yml
    - name: Update the operating system
      include_tasks: tasks/windows/update.yml
    - name: Ensure software is installed
      include_tasks: tasks/windows/install.yml
    - name: Clean up shortcuts
      include_tasks: tasks/windows/shortcuts.yml
    - name: Modify Windows settings
      include_tasks: tasks/windows/windows-settings.yml
    - name: Add/update dotfiles
      include_tasks: tasks/windows/dotfiles.yml
    - name: Attempt authentication
      include_tasks: tasks/windows/authenticate.yml
    - name: Perform miscellaneous tasks
      include_tasks: tasks/windows/misc.yml
- hosts: raspberry:ubuntu-desktop:ubuntu-server:ubuntu-wsl
  tasks:
    - name: Set up authentication (set up .ssh folder)
      include_tasks: tasks/ubuntu/authenticate.yml
- hosts: raspberry:ubuntu-desktop:ubuntu-server:ubuntu-wsl
  become: yes
  tasks:
    - name: Configure /etc/hosts and set hostname
      include_tasks: tasks/ubuntu/hosts.yml
    - name: Update security settings
      include_role:
        name: geerlingguy.security
    - name: Update the operating system
      include_tasks: tasks/ubuntu/update.yml
    - name: Ensure Ubuntu software is installed
      include_tasks: tasks/ubuntu/install.yml
    - name: Run miscellaneous root tasks
      include_tasks: tasks/ubuntu/misc.yml
    - name: Set up the /swapfile
      include_tasks: tasks/ubuntu/swap.yml
    - name: Ensure netdata is installed
      include_tasks: tasks/ubuntu/netdata.yml
- hosts: raspberry:ubuntu-desktop:ubuntu-server:!ubuntu-wsl
  become: yes
  tasks:
    - name: Apply firewall rules
      include_tasks: tasks/ubuntu/ufw/base.yml
- hosts: ubuntu-desktop:ubuntu-server:ubuntu-wsl
  become: yes
  tasks:
    - name: Install NodeJS/NPM
      include_role:
        name: geerlingguy.nodejs
- hosts: ubuntu-desktop:ubuntu-wsl
  tasks:
    - name: Ensure Homebrew and accompanying packages are installed
      include_tasks: tasks/ubuntu/homebrew.yml
- hosts: ubuntu-desktop:ubuntu-wsl
  tasks:
    - name: Add dotfiles
      include_tasks: tasks/ubuntu/dotfiles.yml
- hosts: ubuntu-desktop
  become: yes
  tasks:
    - name: Add OpenVPN profiles
      include_tasks: tasks/ubuntu/vpn-client.yml
- hosts: ubuntu-desktop
  tasks:
    - name: Run miscellaneous desktop tasks
      include_tasks: tasks/ubuntu/desktop-misc.yml
- hosts: awx
  tasks:
    - include_role:
        name: geerlingguy.awx
- hosts: pihole
  become: yes
  tasks:
    - include_role:
        name: cloudflared_role
    - name: Disable wireless
      include_tasks: tasks/ubuntu/disable-wireless.yml
    - name: Add PiHole specific firewall rules
      include_tasks: tasks/ubuntu/ufw/pihole.yml
    - name: Set up PiHole
      include_tasks: tasks/ubuntu/pihole.yml
- hosts: instapy
  become: yes
  tasks:
    - name: Disable wireless
      include_tasks: tasks/ubuntu/disable-wireless.yml
    - name: Set up instapy
      include_tasks: tasks/ubuntu/instapy.yml
- hosts: maas
  become: yes
  tasks:
    - name: Add MAAS specific firewall rules
      include_tasks: tasks/ubuntu/ufw/maas.yml
    - name: Install MAAS
      include_tasks: tasks/ubuntu/maas.yml
- hosts: npm
  tasks:
    - name: Add firewall rules for nginx Proxy Manager
      include_tasks: tasks/ubuntu/ufw/npm.yml
- hosts: pfsense
  connection: paramiko
  tasks:
    - name: Install netdata on pfSense
      include_tasks: tasks/pfsense/netdata.yml
- hosts: all:!windows:!pfsense
  tasks:
    - name: Ensure the docker-compose task is running
      include_tasks: tasks/ubuntu/dockercompose.yml
      when: docker_compose_task is defined