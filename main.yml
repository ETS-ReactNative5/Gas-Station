---
- hosts: pfsense
  tasks:
    - name: Update pfSense configuration
      include_tasks: tasks/pfsense/base.yml
- hosts: windows
  tasks:
    - name: Set hosts file
      include_tasks: tasks/windows/hosts.yml
    - name: Register the product key
      include_tasks: tasks/windows/activation.yml
    - name: Update the operating system
      include_tasks: tasks/windows/update.yml
    - name: Ensure software is installed
      include_tasks: tasks/windows/install.yml
    - name: Clean up shortcuts
      include_tasks: tasks/windows/shortcuts.yml
    - name: Modify Windows settings
      include_tasks: tasks/windows/windows-settings.yml
    - name: Add/update dotfiles
      include_tasks: tasks/windows/dotfiles.yml
    - name: Attempt authentication
      include_tasks: tasks/windows/authenticate.yml
    - name: Perform miscellaneous tasks
      include_tasks: tasks/windows/misc.yml
- hosts: all:!windows:!pfsense
  tasks:
    - name: Install AWX
      include_role:
        name: geerlingguy.awx
      when: install_awx | default(false)
    - name: Ensure the docker-compose task is running
      include_tasks: tasks/ubuntu/dockercompose.yml
      when: docker_compose_task is defined
#    - name: Install InstaPy
#      include_role:
#        name: professormanhattan.ansible_instapy
#      when: install_instapy
    - name: Install MAAS
      include_role:
        name: professormanhattan.ansible_maas
      when: install_maas | default(false)
#    - name: Install nginx Proxy Manager
#      include_role:
#        name: professormanhattan.ansible_nginx_proxy_manager
    - name: Install PiHole
      include_role:
        name: professormanhattan.ansible_pihole_cloudflared
      when: install_pihole | default(false)