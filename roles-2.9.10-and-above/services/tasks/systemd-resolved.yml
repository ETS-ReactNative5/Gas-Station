---
- name: Use CloudFlare's 1.1.1.1 for DNS
  lineinfile:
    path: /etc/systemd/resolved.conf
    regex: "#DNS="
    line: DNS=1.1.1.1#cloudflare-dns.com
  when: cloud_server
  notify: restart systemd-resolved

- name: Use CloudFlare's 1.0.0.1 as a fallback DNS
  lineinfile:
    path: /etc/systemd/resolved.conf
    regex: "#FallbackDNS="
    line: FallbackDNS=1.0.0.1#cloudflare-dns.com
  when: cloud_server
  notify: restart systemd-resolved

- name: Use DNS over TLS
  lineinfile:
    path: /etc/systemd/resolved.conf
    regex: "#DNSOverTLS="
  notify: restart systemd-resolved
