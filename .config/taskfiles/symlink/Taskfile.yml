---
version: '3'

tasks:
  playbook:
    desc: Symlink all the roles in the roles/ folder to ~/.ansible/roles
    summary: |
      # Symlink each role to `~/.ansible/roles/professormanhattan.role_name`

      In the playbook, roles are sometimes referred to by their folder name and in other cases
      they are referred to with their namespace prepended (e.g. `professormanhattan.role_name`).
      This can cause issues so, in order for everything to work, each folder needs to be symlinked
      to `~/.ansible/roles` with the namespace prepended.
    cmds:
      - |
        # find ./roles -mindepth 2 -maxdepth 2 -type d -print0 | while read -d $'\0' ROLE_PATH; do ROLE_FOLDER="$(echo professormanhattan.$(basename $ROLE_PATH))"; if [ ! -d "~/.ansible/roles/$ROLE_FOLDER" ]; then echo "$PWD/$ROLE_PATH"; ln -sf "$PWD/$ROLE_PATH" "$HOME/.ansible/roles/$ROLE_FOLDER"; fi; done
