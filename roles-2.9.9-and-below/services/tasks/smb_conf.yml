---
- name: Configure Samba for sharing the Public folder
  blockinfile:
    path: /etc/samba/smb.conf
    marker: "# ANSIBLE MANAGED BLOCK FOR PUBLIC FOLDER SHARE"
    block: |
      [global]
        hosts allow = 127.0.0.1 10.14.141. 10.14.14. 10.0.0.
        load printers = yes
        map to guest = bad user
        netbios name = {{ samba_netbios_name }}
        obey pam restrictions = yes
        printing = CUPS
        proxy = no
        security = user
        server role = standalone server
        server string = https://my.home.megabyte.space
        unix extension = no
        workgroup = WORKGROUP
      [Media]
        browsable = yes
        comment = Movies, TV Shows, and a bunch of other stuff (read-only)
        follow symlinks = yes
        force user = nobody
        guest only = yes
        guest ok = yes
        path = /home/{{ services_ansible_user }}/Public/Media
        read only = yes
        wide links = yes
      [Public]
        browsable = yes
        comment = Public folder provided for file sharing on the LAN (this is not backed up regularly)
        create mode = 0777
        directory mode = 0777
        follow symlinks = no
        force create mode = 0777
        force directory mode = 0777
        force user = nobody
        guest ok = yes
        guest only = yes
        path = /home/{{ services_ansible_user }}/Public/Public
        read only = no
        writable = yes
      [printers]
        browsable = yes
        comment = Printers
        create mode = 0700
        guest ok = yes
        path = /var/spool/samba
        printable = yes
        printer admin = root
        read only = yes
        writable = no
      [print$]
        browsable = yes
        comment = Printer drivers
        guest ok = yes
        path = /var/lib/samba/printers
        read only = yes
      [HP_OfficeJet_Pro_6978]
        comment = HP OfficeJet Pro 6978 (in Garage)
        guest ok = yes
        path = /var/spool/samba
        printable = yes
        printer admin = root
        public = yes
      [Private]
        browsable = yes
        comment = Authenticated share with read/write capabilities (backed up to OneDrive)
        directory mode = 0777
        follow symlinks = no
        force create mode = 0777
        guest only = no
        guest ok = no
        path = /mnt/{{ services_ansible_user }}/onedrive/Protected
        read only = no
        valid users = @sambausers
        writable = yes
  notify: restart samba