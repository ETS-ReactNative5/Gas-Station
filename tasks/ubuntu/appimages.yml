---
- name: Clone AppImages from repository
  git:
    repo: "{{ ubuntu_appimages_repository }}"
    dest: ~/Applications
    depth: "1"
    force: yes
- name: Make Applications executable
  file:
    path: ~/Applications
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "700"
    recurse: yes
- name: Copy appimaged.deb file over to client
  copy:
    src: files/ubuntu/appimaged.deb
    dest: ~/Downloads/appimaged.deb
- name: Install appimaged
  become: yes
  command: "dpkg -i /home/{{ ansible_user }}/Downloads/appimaged.deb"
- name: Remove appimaged.deb file
  file:
    path: ~/Downloads/appimaged.deb
    state: absent
- name: Run necessary systemctl commands
  command: systemctl --user add-wants default.target appimaged
- name: Run necessary systemctl command
  command: systemctl --user start appimaged