---
- name: Copy .gitconfig
  copy:
    src: files/dotfiles/.gitconfig
    dest: ~/.gitconfig
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "600"
- name: Copy .localrc
  copy:
    src: files/dotfiles/.localrc
    dest: ~/.localrc
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "600"
- name: Remove starship import if no homebrew packages are present
  lineinfile:
    path: ~/.localrc
    regex: "starship init bash"
    line: '#eval "$(starship init bash)"'
  when: not ((homebrew_packages | default([])) | length)
- name: Ensure .bashrc exists
  file:
    path: ~/.bashrc
    state: touch
- name: Source .localrc from .bashrc (if the source call does not already exist)
  lineinfile:
    path: ~/.bashrc
    regex: "^source ~\/.localrc$"
    line: source ~/.localrc
- name: Set PATH in .bashrc
  lineinfile:
    path: ~/.bashrc
    regex: "# PATH modified by Ansible"
    line: "export PATH=$PATH:/home/{{ ansible_user }}/.local/bin # PATH modified by Ansible"
- name: Copy .netrc
  copy:
    src: files/dotfiles/.netrc
    dest: ~/.netrc
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "600"
  when:
    - "'raspberry' not in group_names"
    - "'ubuntu-server' not in group_names"
- name: Copy .npmrc
  copy:
    src: files/dotfiles/.npmrc
    dest: ~/.npmrc
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "600"
- name: Copy .zshrc
  copy:
    src: files/dotfiles/.zshrc
    dest: ~/.zshrc
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "600"
- name: Remove starship import from user's .zshrc
  lineinfile:
    path: ~/.zshrc
    regex: "starship init zsh"
    line: '#eval "$(starship init zsh)"'
  when: not ((homebrew_packages | default([])) | length)
- name: Set PATH in root .bashrc
  become: yes
  lineinfile:
    path: /root/.bashrc
    regex: "# PATH modified by Ansible (root user)"
    line: "PATH=$PATH:/snap/bin # PATH modified by Ansible (root user)"
- name: Copy .gitconfig to root user's home directory
  become: yes
  copy:
    src: files/dotfiles/.gitconfig-root
    dest: /root/.gitconfig
    owner: root
    group: root
    mode: "600"
- name: Copy .localrc to root user's home directory
  become: yes
  copy:
    src: files/dotfiles/.localrc
    dest: /root/.localrc
    owner: root
    group: root
    mode: "600"
- name: Remove starship import if no homebrew packages are present
  become: yes
  lineinfile:
    path: /root/.localrc
    regex: "starship init bash"
    line: '#eval "$(starship init bash)"'
  when: not ((homebrew_packages | default([])) | length)
- name: Ensure .bashrc exists in root user's home directory
  become: yes
  file:
    path: /root/.bashrc
    state: touch
- name: Source .localrc from root's .bashrc (if the source call does not already exist)
  become: yes
  lineinfile:
    path: /root/.bashrc
    regex: "^source ~\/.localrc$"
    line: source ~/.localrc
- name: Copy .zshrc to root user's home directory
  become: yes
  copy:
    src: files/dotfiles/.zshrc
    dest: /root/.zshrc
    owner: root
    group: root
    mode: "600"
- name: Remove starship import if no homebrew packages are present
  become: yes
  lineinfile:
    path: /root/.zshrc
    regex: "starship init zsh"
    line: '#eval "$(starship init zsh)"'
  when: not ((homebrew_packages | default([])) | length)