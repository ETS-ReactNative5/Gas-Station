---
- name: "Test {{ item }}"
  lineinfile:
    dest: /etc/hosts
    regexp: "{{ etc_hosts[item].regexp }}"
    line: "{{ etc_hosts[item].ip_address }} {{ etc_hosts[item].hosts }} {{ etc_hosts[item].regexp }}"
    state: present
  when:
      - item not in (etc_hosts_localhost_override | default([]))
      - not (etc_hosts_override | default(false))