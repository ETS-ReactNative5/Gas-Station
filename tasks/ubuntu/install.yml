---
- name: Install software
  apt:
    name: "{{ item.name | default(item) }}"
    state: "{{ item.state | default('present') }}"
  with_items: "{{ software | default([]) }}"
- name: Install snaps
  snap:
    name: "{{ item.name | default(item) }}"
    classic: "{{ item.classic | default('no') }}"
  with_items: "{{ snaps | default([]) }}"
- name: Create Docker system group
  group:
    name: docker
    state: present
    system: yes
  when: snaps | default([]) | selectattr("name", "equalto", "docker") | list | first | default(false)
- name: Add user to the Docker system group
  user:
    name: "{{ ansible_user }}"
    groups:
      - docker
    append: yes
  when: snaps | default([]) | selectattr("name", "equalto", "docker") | list | first | default(false)
- name: Restart the Docker service
  systemd:
    name: "snap.docker.dockerd"
    state: restarted
  when: snaps | default([]) | selectattr("name", "equalto", "docker") | list | first | default(false)
- name: Install pips
  become: yes
  become_user: "{{ ansible_user }}"
  pip:
    executable: pip3
    name: "{{ item.name }}"
  with_items: "{{ pips | default([]) }}"
- name: Install Visual Studio Code plugins
  become: yes
  become_user: "{{ ansible_user }}"
  shell: "/snap/bin/code --install-extension {{ item }}"
  with_items: "{{ vscode_plugins | default([]) }}"
