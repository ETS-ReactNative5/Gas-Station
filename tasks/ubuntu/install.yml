---
- name: Install software
  apt:
    name: "{{ item.name | default(item) }}"
    state: "{{ item.state | default('present') }}"
  with_items: "{{ software | default([]) }}"
- name: Install host-specific software
  apt:
    name: "{{ item.name | default(item) }}"
    state: "{{ item.state | default('present') }}"
  with_items: "{{ host_software | default([]) }}"
- name: Install snaps
  snap:
    name: "{{ item.name | default(item) }}"
    classic: "{{ item.classic | default('no') }}"
  with_items: "{{ snaps | default([]) }}"
- name: Install host-specific snaps
  snap:
    name: "{{ item.name | default(item) }}"
    classic: "{{ item.classic | default('no') }}"
  with_items: "{{ host_snaps | default([]) }}"
- name: Set up Docker if it was installed
  include_tasks: tasks/ubuntu/applications/docker.yml
  when: install_docker
- name: Install pips
  become: yes
  become_user: "{{ ansible_user }}"
  pip:
    executable: pip3
    name: "{{ item.name }}"
  with_items: "{{ pips | default([]) }}"
- name: Install pips
  become: yes
  become_user: "{{ ansible_user }}"
  pip:
    executable: pip3
    name: "{{ item.name }}"
  with_items: "{{ host_pips | default([]) }}"
- name: Install Visual Studio Code plugins
  become: yes
  become_user: "{{ ansible_user }}"
  shell: "/snap/bin/code --install-extension {{ item }}"
  with_items: "{{ vscode_plugins | default([]) }}"
- name: Install and configure Rclone if rclone_providers is defined
  include_tasks: tasks/ubuntu/applications/rclone.yml
  when: rclone_providers is defined
