---
- name: Ensure .ssh directory exists.
  file: 
    dest: ~/.ssh
    mode: '700'
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    state: directory
- name: Set authorized key
  authorized_key:
    user: "{{ ansible_user }}"
    state: present
    key: "{{ lookup('file', 'files/keys/{{ authorized_key_file }}') }}"
  when: authorized_key_file is defined
- name: Copy SSH private keys
  copy:
    src: "files/keys/{{ item }}"
    dest: "~/.ssh/{{ item }}"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "600"
  with_items: "{{ ssh_private_keys | default([]) }}"
- name: Copy SSH public keys
  copy:
    src: "files/keys/{{ item }}.pub"
    dest: "~/.ssh/{{ item }}"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '644'
  with_items: "{{ ssh_private_keys | default([]) }}"
- name: Copy SSH known_hosts
  copy:
    src: files/keys/known_hosts
    dest: ~/.ssh/known_hosts
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '644'
  when: ssh_private_keys is defined
- name: Copy SSH config
  copy:
    src: files/keys/config
    dest: ~/.ssh/config
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: '644'
  when: ssh_private_keys is defined