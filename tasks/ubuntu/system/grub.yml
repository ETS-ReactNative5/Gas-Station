---
- name: Optimize the GRUB resolution (press C at GRUB menu and then enter videoinfo, then set grub_gfxmode to max allowed resolution)
  lineinfile:
    path: /etc/default/grub
    regex: "GRUB_GFXMODE="
    line: "GRUB_GFXMODE={{ grub_gfxmode }},auto"
- name: Set GRUB timeout
  lineinfile:
    path: /etc/default/grub
    regex: "GRUB_TIMEOUT="
    line: "GRUB_TIMEOUT={{ grub_timeout }}"
- name: Copy/unarchive theme
  unarchive:
    src: "files/themes/grub/{{ grub_theme }}.tar.xz"
    dest: "/tmp"
- name: Install the GRUB theme
  command: bash install.sh
  args:
    chdir: "/tmp/{{ grub_theme }}"
- name: Clean up temporary theme installer files
  file:
    path: "/tmp/{{ grub_theme }}"
    state: absent
- name: Add configuration file that allows menu to be shown when shift key is held down
  copy:
    src: files/config/grub/31_hold_shift
    dest: /etc/grub.d/31_hold_shift
    owner: root
    group: root
    mode: "755"
- name: Configure GRUB to only show when Shift key is held down
  lineinfile:
    path: /etc/default/grub
    regex: "GRUB_FORCE_HIDDEN_MENU="
    line: 'GRUB_FORCE_HIDDEN_MENU="true"'
- name: Update GRUB
  command: update-grub
  ignore_errors: yes
