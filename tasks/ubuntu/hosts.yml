---
- name: Set hostname
  hostname:
    name: "{{ hostname }}"
  when: hostname is defined
- name: Set up /etc/hosts file
  lineinfile:
    dest: /etc/hosts
    regexp: "{{ etc_hosts[item].regexp }}"
    line: "{{ etc_hosts[item].ip_address }} {{ etc_hosts[item].hosts }} {{ etc_hosts[item].regexp }}"
    state: present
  when:
    - item not in (apps_installed | default([]))
    - not (etc_hosts_override | default(false))
    - not (no_etc_hosts | default(false))
  with_items: "{{ etc_hosts_list }}"
- name: Set up /etc/hosts for client with etc_hosts_override set
  lineinfile:
    dest: /etc/hosts
    regexp: "{{ etc_hosts[item].regexp }}"
    line: "{{ etc_hosts[item].ip_address }} {{ etc_hosts[item].hosts }} {{ etc_hosts[item].regexp }}"
    state: present
  when: item in (etc_hosts_override | default([]))
  with_items: "{{ etc_hosts_list }}"
- name: Set up /etc/hosts file for local services
  lineinfile:
    dest: /etc/hosts
    regexp: "{{ etc_hosts[item].regexp }}"
    line: "127.0.0.1 {{ etc_hosts[item].hosts }} {{ etc_hosts[item].regexp }}"
    state: present
  when: item in (apps_installed | default([]))
  with_items: "{{ etc_hosts_list }}"