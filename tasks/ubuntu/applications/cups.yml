---
# Source: https://www.linuxbabe.com/ubuntu/set-up-cups-print-server-ubuntu-bonjour-ipp-samba-airprint
- name: Download CUPS and related packages
  apt:
    name:
      - avahi-daemon 
      - cups
    state: latest
  when: 
- name: Copy the CUPS configuration over
  copy:
    src: files/config/cupsd.conf
    dest: /etc/cups/cupsd.conf
    owner: root
    group: root
    mode: "644"
- name: Restart CUPS and enable on start up
  systemd:
    name: cups
    state: restarted
    enabled: yes
- name: Restart avahi-daemon and enable on start up
  systemd:
    name: avahi-daemon
    state: restarted
    enabled: yes
- name: Restart the Samba service
  service:
    name: smbd
    state: restarted
- name: Configure UFW for Samba
  ufw:
    comment: Allow LAN access to Samba
    port: "631"
    proto: tcp
    rule: allow
    src: "{{ item }}"
  with_items: "{{ rc1918_networks }}"
- name: Allow Avahi daemon access
  ufw:
    comment: Allow Bonjour and IPP protocols
    port: "5353"
    proto: udp
    rule: allow
    src: "{{ item }}"
  with_items: "{{ rc1918_networks }}"