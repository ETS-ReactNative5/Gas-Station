---
- name: Acquire a list of sources from /etc/apt/sources.list.d/*
  become: yes
  find:
    paths:
      - /etc/apt/sources.list.d
  register: sources_files
- name: Configure /etc/apt/sources.list.d/* to use Tor as the transport (https://)
  become: yes
  replace:
    path: "{{ item.path }}"
    regexp: " tor+https:\/\/"
    replace: " https://"
  with_items: "{{ sources_files.files }}"
- name: Configure /etc/apt/sources.list.d/* to use Tor as the transport (http://)
  become: yes
  replace:
    path: "{{ item.path }}"
    regexp: " tor+http:\/\/"
    replace: " http://"
  with_items: "{{ sources_files.files }}"