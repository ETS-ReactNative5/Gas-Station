---
- name: Install Tor and Privoxy
  apt:
    name:
      - privoxy
      - tor
    state: latest
- name: Forward proxy connections to Tor
  lineinfile:
    path: /etc/privoxy/config # https://fabianlee.org/2018/02/11/ubuntu-a-centralized-apt-package-cache-using-apt-cacher-ng/
    regex: "forward-socks5t / localhost"
    line: forward-socks5t / localhost:9050 .
- name: Restart Privoxy
  service:
    name: privoxy
    state: restarted
- name: Enforce using USA exit node with Tor connections
  blockinfile:
    path: /etc/tor/torrc
    block: |
      ExitNodes {us}
      StrictNodes 1
- name: Reload Tor
  service:
    name: tor
    state: restarted
- name: Set SOCKS5 proxy port # For GNOME only
  shell: gsettings set org.gnome.system.proxy.socks port 8118
- name: Set SOCKS5 proxy address
  shell: gsettings set org.gnome.system.proxy.socks host 'localhost'
- name: Set HTTP proxy port
  shell: gsettings set org.gnome.system.proxy.http port 8118
- name: Set HTTP proxy address
  shell: gsettings set org.gnome.system.proxy.http host 'localhost'
- name: Set HTTPS proxy port
  shell: gsettings set org.gnome.system.proxy.https port 8118
- name: Set HTTPS proxy address
  shell: gsettings set org.gnome.system.proxy.https host 'localhost'
- name: Set FTP proxy port
  shell: gsettings set org.gnome.system.proxy.ftp port 8118
- name: Set FTP proxy address
  shell: gsettings set org.gnome.system.proxy.ftp host 'localhost'
