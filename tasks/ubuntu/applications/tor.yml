---
- name: Install Tor and Privoxy
  apt:
    name:
      - privoxy
      - tor
    state: latest
- name: Forward proxy connections to Tor
  lineinfile:
    path: /etc/privoxy/config # https://fabianlee.org/2018/02/11/ubuntu-a-centralized-apt-package-cache-using-apt-cacher-ng/
    regex: "forward-socks5 / localhost"
    line: forward-socks5 / localhost:9050 .
- name: Restart Privoxy
  service:
    name: privoxy
    state: restarted
- name: Enforce using USA exit node with Tor connections
  blockinfile:
    path: /etc/tor/torrc
    block: |
      ExitNodes {us}
      StrictNodes 1
- name: Reload Tor
  service:
    name: tor
    state: restarted