---
- name: Ensure CloudFlare records are updated
  cloudflare_dns:
    zone: "{{ hosts[item].dns_zone }}"
    record: "{{ hosts[item].dns_record }}"
    type: A
    value: "{{ hosts[item].ip_address }}"
    solo: yes
    state: present
    account_email: "{{ cloudflare_email }}"
    account_api_token: "{{ cloudflare_api_token }}"
  with_items: "{{ apps_installed }}"
  when: cloud_server