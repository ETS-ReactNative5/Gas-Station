---
- name: Rename id_rsa_web to id_rsa
  shell: mv ~/.ssh/id_rsa_web ~/.ssh/id_rsa
- name: Make sure InstaPy code is present via git
  git:
    repo: "{{ instapy_repo }}"
    dest: ~/InstaPy
- name: Remove SSH key used for updating InstaPy
  file:
    path: ~/.ssh/id_rsa
    state: absent
- name: Pull the latest with docker-compose pull
  shell: cd InstaPy && docker-compose pull
- name: Ensure a cron job exists so that InstaPy runs daily
  cron:
    name: InstaPy task runner
    minute: "14"
    hour: "12"
    user: "{{ ansible_user }}"
    job: "cd ~/InstaPy && docker-compose pull && docker-compose up -d"
    cron_file: ansible_instapy_daily