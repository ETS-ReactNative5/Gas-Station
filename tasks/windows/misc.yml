---
- name: Install Starship via Scoop
  block:
    - name: Install Scoop
      win_shell: Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')
    - name: Update Scoop
      win_shell: scoop update
    - name: Install Scoops
      win_shell: "scoop install {{ item }}"
      with_items: "{{ scoop_packages | default([]) }}"
  rescue:
    - name: Remove scoop folder from user directory
      win_file:
        path: "%USERPROFILE%\\scoop"
        state: absent
- name: Remove "source" directory from user folder
  win_file:
    path: "%USERPROFILE%\\source"
    state: absent
- name: "Check if Logitech has a start menu shortcut in a folder in the Windows shared start menu location"
  win_stat:
    path: "{{ windows_startmenu }}\\Logitech\\Logitech Options.lnk"
  register: startmenu_shortcut
- name: Check if Logitech start menu entry was already moved
  win_stat:
    path: "{{ windows_startmenu}}\\Logitech Options.lnk"
  register: logitech_startmenu_lnk
- name: "Move the Logitech Options shortcut to the parent directory if it resides in a folder"
  win_shell: "mv '{{ windows_startmenu }}\\Logitech\\Logitech Options.lnk' '{{ windows_startmenu }}\\Logitech Options.lnk'"
  when:
   - startmenu_shortcut.stat.exists
   - not logitech_startmenu_lnk.stat.exists
- name: "Remove the Logitech folder from the start menu if it exists"
  win_file:
    path: "{{ windows_startmenu }}\\Logitech"
    state: absent
- name: "Remove the Visual Studio Installer link if it is present"
  win_file:
    path: "{{ windows_startmenu }}\\Visual Studio Installer.lnk"
    state: absent
- name: "Remove Malwarebytes root directory folder if it is present"
  win_file:
    path: C:\Malwarebytes
    state: absent
- name: Remove OneDriveTemp
  win_file:
    path: C:\OneDriveTemp
    state: absent
- name: Hide files in user directory
  win_shell: attrib +h $env:USERPROFILE\\{{ item }}
  loop:
    - .android
    - .AndroidStudio4.0
    - .config
    - .docker
    - .ssh
    - .vagrant.d
    - .vscode
    - .bashrc
    - .gitconfig
    - .localrc
    - .netrc
    - .npmrc
    - .zshrc
    - Postman
    - scoop
- name: Remove .idlerc
  win_file:
    path: "%USERPROFILE%\\.idlerc"
    state: absent
- name: Remove $WinREAgent folder from root
  win_file:
    path: C:\$WinREAgent
    state: absent
- name: Add Mountain Duck license
  win_copy:
    src: files/keys/ch_1H1lo0Gl0sbquLOPJoXN8eRC.mountainducklicense
    dest: "%USERPROFILE%\\AppData\\Roaming\\Cyberduck\\ch_1H1lo0Gl0sbquLOPJoXN8eRC.mountainducklicense"