---
- name: List installed MAS apps
  become: false
  command: mas list
  register: mas_list
  changed_when: false

- name: Ensure configured MAS apps are installed
  become: false
  command: "mas install '{{ item.id | default(item) }}'"
  loop: "{{ mas_desktop_software }}"
  when: (item.id | string) not in mas_list.stdout

- name: Upgrade all apps (if configured)
  become: false
  command: mas upgrade
  when: mas_upgrade_all_apps

- name: Ensure Termial size is configured # noqa 301 303
  become_user: "{{ user.username }}"
  shell: |
    /usr/libexec/PlistBuddy -c "Delete :Window\ Settings:Basic:columnCount" ~/Library/Preferences/com.apple.Terminal.plist
    /usr/libexec/PlistBuddy -c "Add :Window\ Settings:Basic:columnCount integer {{ mac_terminal_width }}" ~/Library/Preferences/com.apple.Terminal.plist
    /usr/libexec/PlistBuddy -c "Delete :Window\ Settings:Basic:rowCount" ~/Library/Preferences/com.apple.Terminal.plist
    /usr/libexec/PlistBuddy -c "Add :Window\ Settings:Basic:rowCount integer {{ mac_terminal_height }}" ~/Library/Preferences/com.apple.Terminal.plist
  loop: "{{ user_configs }}"
  loop_control:
    label: "{{ user.username }}"
    loop_var: user
  when: (user.system is not defined) or ((user.system is defined) and (not user.system))
