---
- name: Install AppImages
  become: true
  become_user: "{{ user.username }}"
  block:
    - include_tasks: appimages-Linux.yml

# TODO: Convert this code to use the systemd module instead
- name: Run necessary systemctl commands # noqa 301 303
  become: true
  become_user: "{{ user.username }}"
  command: systemctl --user add-wants default.target appimaged

# TODO: Convert this code to use the systemd module instead
- name: Run necessary systemctl command # noqa 301 303
  become: true
  become_user: "{{ user.username }}"
  command: systemctl --user start appimaged

- name: Apply user dconf settings
  become: true
  become_user: "{{ user.username }}"
  community.general.dconf:
    key: "{{ item.key | string }}"
    value: "{{ item.value | string }}"
    state: present
  loop: "{{ user.dconf_settings }}"
  loop_control:
    label: "{{ item.key }}"
