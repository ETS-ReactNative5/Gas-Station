---
- name: Copy OpenVPN file into temporary directory
  copy:
    src: "files/vpn/{{ item.file }}"
    dest: "{{ openvpn_tmp_dir }}/{{ item.file }}"

- name: "Import and configure OpenVPN connection ({{ item.file }})"
  command: |
    nmcli connection import type openvpn file '{{ item.file }}'
    nmcli connection modify '{{ ovpn_name }}' +vpn.data username={{ item.username }}
    nmcli connection modify '{{ ovpn_name }}' vpn.secrets 'password={{ item.password }}'
    nmcli connection modify '{{ ovpn_name }}' +vpn.data password-flags=0
  args:
    chdir: "{{ openvpn_tmp_dir }}"
  notify: restart networkmanager
