---
- name: Ensure ansible_user has password set
  user:
    name: "{{ ansible_user }}"
    password: "{{ ansible_password | password_hash('sha512', password_salt) }}"

- name: Set hostname
  hostname:
    name: "{{ hostname }}"
  when: hostname is defined

- name: Set time zone
  timezone:
    name: "{{ timezone }}"

- name: Set ANSIBLE_PLAYBOOK_USER name environment variable
  lineinfile:
    path: /etc/environment
    regex: "^ANSIBLE_PLAYBOOK_USER="
    line: "ANSIBLE_PLAYBOOK_USER={{ ansible_user }}"

- name: Set MOTD
  copy:
    src: motd
    dest: /etc/motd
    owner: root
    group: root
    mode: "0644"
# TODO: Convert the above commands to Mac OS X and add to setup-Darwin.yml
- name: Customize GRUB
  include_tasks: linux/grub.yml

- name: Check if boot loading image (Plymouth) is already present
  stat:
    path: "{{ plymouth_themes_dir }}/{{ plymouth_theme }}/{{ plymouth_theme }}.plymouth"
  register: plymouth_theme

- name: Customize boot loading image (Plymouth)
  include_tasks: linux/plymouth.yml
  when: not plymouth_theme.stat.exists

- name: Configure swap
  include_tasks: linux/swap.yml

- name: Ensure git-cache-meta is installed in /usr/bin
  copy:
    src: git-cache-meta.sh
    dest: /usr/bin/git-cache-meta
    owner: root
    group: root
    mode: "0755"
