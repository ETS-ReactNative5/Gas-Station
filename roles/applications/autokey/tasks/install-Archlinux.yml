---
- name: Ensure that the dependencies are installed
  community.general.pacman:
    name: "{{ pkg_dependencies }}"
    udpate_cache: true
    state: present

- name: Check if Autokey is installed
  ansible.builtin.stat:
    path: /usr/sbin/autokey-gtk
  register: autokey_stat

- name: Install Autokey if not already installed
  block:
    - name: Ensure to create a temporary directory for Autokey source files
      ansible.builtin.file:
        path: "{{ temp_directory }}"
        state: directory
        mode: '0770'
    - name: Ensure that Autokey repo is cloned
      ansible.builtin.git:
        repo: "{{ autokey_aur_repo_url }}"
        dest: "{{ temp_directory }}"
        clone: true
    - name: Ensure Autokey is installed
      command: makepkg -sic --noconfirm
      args:
        chdir: "{{ temp_directory }}"
        creates: /usr/sbin/autokey-gtk
  when:
    - not autokey_stat.stat.exists
  always:
    - name: Ensure to remove the temporary directory created for Autokey source files
      ansible.builtin.file:
        path: "{{ temp_directory }}"
        state: absent
