---
- name: Check if Visual Studio Code cask is already present
  command: "{{ homebrew_path }} list --cask"
  changed_when: false
  register: vscode_state

- name: Install Visual Studio Code if it is not installed
  block:
    - name: Check if Visual Studio Code is already installed
      assert:
        that:
          - vscode_state.stdout.find('visual-studio-code') != -1
        fail_msg: "Visual Studio Code is not installed"
        success_msg: "Visual Studio Code is already installed"

  rescue:
    - name: Install Visual Studio Code via Homebrew
      community.general.homebrew:
        name: visual-studio-code
        state: present

    - name: Install Visual Studio Code cask
      homebrew_cask:
        name: visual-studio-code
        state: present
        install_options: force
