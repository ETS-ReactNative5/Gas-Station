---
- name: Ensure osxfuse is installed
  become: false
  community.general.homebrew_cask:
    name: osxfuse
    state: "{{ app_state | default('present') }}"
    sudo_password: "{{ ansible_password }}"
    accept_external_apps: "{{ allow_external_apps | default(false) }}"

- name: Ensure catfs is intalled
  include_tasks: catfs-Linux.yml

- name: Ensure goofys is installed
  become: false
  community.general.homebrew:
    name: goofys
    state: "{{ app_state | default('latest') }}"

- name: Ensure S3 buckets are mounted # noqa 301
  command: "goofys {{ item.bucket }} {{ item.path }}"
  environment:
    PATH: /usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:{{ ansible_env.PATH }}
  when: s3_mounts is defined
  loop: "{{ s3_mounts }}"
