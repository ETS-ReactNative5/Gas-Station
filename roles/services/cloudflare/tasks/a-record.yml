---
- name: Ensure CloudFlare A record is updated
  cloudflare_dns:
    zone: "{{ hosts[item.name].dns_zone }}"
    record: "{{ hosts[item.name].dns_record }}"
    type: A
    value: "{{ hosts[item.name].ip_address }}"
    solo: yes
    state: present
    account_email: "{{ cloudflare_email }}"
    account_api_token: "{{ cloudflare_api_token }}"
  when:
    - hosts[item.name].dns_zone is defined
    - hosts[item.name].dns_record is defined
    - hosts[item.name].ip_address is defined
