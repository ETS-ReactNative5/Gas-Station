---
- name: Load variable file based on the OS type, or a default if not found
  include_vars: "{{ item }}"
  with_first_found:
    - "{{ ansible_distribution }}-{{ ansible_distribution_version }}.yml"
    - "{{ ansible_distribution }}.yml"
    - "{{ ansible_os_family }}.yml"
    - "default.yml"

- name: Perform RedHat setup
  become: true
  block:
    - import_tasks: setup-RedHat.yml
  when: ansible_os_family == 'RedHat'

- name: Install Certbot via package
  become: true
  block:
    - import_tasks: package-Linux.yml
  when: not certbot_install_from_source

- name: Install Certbot from source
  become: true
  block:
    - import_tasks: source-Linux.yml
  when: certbot_install_from_source

- name: Generate certificate
  become: true
  block:
    - include_tasks: certificates-Linux.yml

- name: Add auto-renewal cronjob
  become: true
  block:
    - import_tasks: cron-Linux.yml
  when: certbot_auto_renew
