---
- name: Install pip
  pacman:
    name: python-pip
    state: present

- name: Install docker pip package
  pip:
    name: docker
    state: present

- name: Pull netdata image
  docker_image:
    name: netdata/netdata
    source: pull

- name: Create required volumes
  docker_volume:
    name: "{{ item }}"
  loop: "{{ docker_volume_list }}"

- name: Run netdata docker container
  docker_container:
    name: netdata
    image: netdata/netdata
    restart_policy: unless-stopped
    capabilities:
      - SYS_PTRACE
    ports:
      - 19999:19999
    volumes:
      - netdataconfig:/etc/netdata
      - netdatalib:/var/lib/netdata
      - netdatacache:/var/cache/netdata
    mounts:
      - source: "{{ item.host_path }}"
        target: "{{ item.container_path }}"
        type: bind
        read_only: true
  loop: "{{ bind_volumes }}"
