---
- name: Ensure MongoDB's dependencies are installed
  dnf:
    name: "{{ mongodb_dependencies }}"
    state: "{{ app_state | default('present') }}"
    update_cache: true

- name: Find the latest version of MongoDB package
  uri:
    url: "http://repo.mongodb.org/yum/redhat/{{ ansible_distribution_major_version }}/mongodb-org/{{ mongodb_version }}/x86_64/RPMS/"
    return_content: true
  register: mongodb_versions

- name: Save the name of MongoDB RPM file to a variable
  set_fact:
    mongodb_rpm: "{{ mongodb_versions.content | regex_findall('mongodb-org-server-[(\\d\\.)*\\d*-el\\d\\.]*x86_64\\.rpm') | last }}"

- name: Ensure MongoDB is installed
  dnf:
    name: "http://repo.mongodb.org/yum/redhat/{{ ansible_distribution_major_version }}/mongodb-org/{{ mongodb_version }}/x86_64/RPMS/{{ mongodb_rpm }}"
    state: present

- name: Run generic Linux tasks
  include_tasks: install-Linux.yml
