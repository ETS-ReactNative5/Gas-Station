---
- name: Install Docker Compose on x86_64 system
  block:
    - name: Check current docker-compose version.
      command: docker-compose --version
      register: docker_compose_current_version
      changed_when: false
      failed_when: false
    - name: Delete existing docker-compose version if it's different.
      file:
        path: "{{ docker_compose_path }}"
        state: absent
      when:
        - docker_compose_current_version.stdout is defined
        - docker_compose_version not in docker_compose_current_version.stdout
    # @action fatal: [workstation]: FAILED! => {"changed": false, "dest": "/usr/local/bin/docker-compose", "elapsed": 120, "msg": "Request failed: <urlopen error [Errno -2] Name or service not known>", "url": "https://github.com/docker/compose/releases/download/1.26.0/docker-compose-Linux-x86_64"}
    # @action I think installing Docker caused the internet to go out - rebooting
    - name: Install Docker Compose (if configured).
      become: true
      get_url:
        url: https://github.com/docker/compose/releases/download/{{ docker_compose_version }}/docker-compose-Linux-x86_64
        dest: "{{ docker_compose_path }}"
        mode: 0755
  when: ansible_architecture == 'x86_64'

- name: Install Docker Compose on non-x86_64 system
  package:
    name: docker-compose
    state: present
  when: ansible_architecture != 'x86_64'
