---
- name: Install OpenSSL
  win_chocolatey:
    name: openssl
    state: present

- name: Generate the security certificates
  block:
    - name: Generate the PowerShell script
      win_template:
        src: docker-tls.ps1.j2
        dest: C:\docker-tls.ps1
    - name: Execute the script to generate security certificates
      win_shell: C:\docker-tls.ps1
  always:
    - name: Remove the script used to generate security certificates
      win_file:
        path: C:\docker-tls.ps1
        state: absent
