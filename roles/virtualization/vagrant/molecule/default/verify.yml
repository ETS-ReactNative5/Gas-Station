---
- name: Verify
  hosts: all
  gather_facts: false
  tasks:
    - name: Run Vagrant's help command and register the ouput
      command: vagrant --help
      changed_when: false
      failed_when: '"Usage: vagrant" not in this.stdout'
      register: this

    - name: Assert that Vagrant's help command outputs the correct phrase
      assert:
        that: '"Usage: vagrant" in this.stdout'

    - name: List Vagrant's plugins and register the output
      command: vagrant plugin
      changed_when: false
      failed_when: '"vagrant-vmware-desktop" not in this_plugin.stdout'
      register: this_plugin

    - name: Assert that the VMWare plugin is in the list of Vagrant plugins
      assert:
        that: '"vagrant-vmware-desktop" in this_plugin.stdout'
